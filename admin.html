<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | QR</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<hr>

<h3>Attendance Dashboard</h3>

<p>
  <strong>Total Attendance:</strong> <span id="total">0</span><br>
  <strong>Today:</strong> <span id="today">0</span>
</p>

<button onclick="loadDashboard()">Refresh Data</button>

<table border="1" cellpadding="8" cellspacing="0">
  <thead>
    <tr>
      <th>Time</th>
      <th>QR Data</th>
    </tr>
  </thead>
  <tbody id="attendanceTable"></tbody>
</table>
<section class="admin-set">
        <img src="logo.png" alt="">
    <h2>ScanAttend Admin</h2>

<div id="login">
  <input id="adminPass" type="password" placeholder="Admin Password"><br>
  <button onclick="adminLogin()">Login</button>
</div>

<div id="panel" style="display:none;">

  <h3>Venue Settings</h3>
  <input id="venueLat" placeholder="Latitude"><br><br>
  <input id="venueLng" placeholder="Longitude"><br><br>
  <input id="venueRadius" placeholder="Radius (meters)"><br><br>
  <button onclick="saveLocation()">Save Location</button>
  <h3>Daily QR</h3>
  <button onclick="generateQR()">Generate Todayâ€™s QR</button>
  <div id="qr"></div>
</div>
<button onclick="logout()">Logout</button>
</section>

<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
<script src="qr.js"></script>

<script>
const ADMIN_PASSWORD = "admin123";

function adminLogin(){
  if (adminPass.value === ADMIN_PASSWORD) {
    localStorage.setItem("isAdmin","true");
    login.style.display="none";
    panel.style.display="block";
  } else alert("Wrong password");
}

function logout(){
  localStorage.removeItem("isAdmin");
  location.reload();
}

if (localStorage.getItem("isAdmin")==="true"){
  login.style.display="none";
  panel.style.display="block";
}
</script>
<script>
const DASHBOARD_URL = "https://script.google.com/macros/s/AKfycby7lDB1nEMEbSrmx45oHZTpiI-cGr9FBGGANfSnt3bllYWtGaPAsQzCmfdJnqtb-Nj8/exechttps://script.google.com/macros/s/AKfycbzk10M26SgP4PrnBrBnnjSPzqAuNxauuG0-zKhY5NecJJEkeQqi_mJhJ-bnn1-UGMnR4w/exec";

function loadDashboard() {
  fetch(DASHBOARD_URL)
    .then(res => res.json())
    .then(data => {
      document.getElementById("total").innerText = data.total;
      document.getElementById("today").innerText = data.today;

      const tbody = document.getElementById("attendanceTable");
      tbody.innerHTML = "";

      data.rows.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.time}</td><td>${row.qr}</td>`;
        tbody.appendChild(tr);
      });
    })
    .catch(() => alert("Failed to load dashboard"));
}

// Auto-load on admin login
if (localStorage.getItem("isAdmin") === "true") {
  loadDashboard();
}
</script>

</body>
</html>